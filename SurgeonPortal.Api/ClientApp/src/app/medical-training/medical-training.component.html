<header>
  <h1>Medical Training</h1>
</header>
<ng-container>
  <section>
    <div class="grid">
      <div class="col-12 flex">
        <abs-profile-header
          [profilePicture]="user.profilePicture"
          [user]="user"
        ></abs-profile-header>
      </div>
    </div>
  </section>
  <section>
    <div class="grid">
      <sl-card class="col-12">
        <form id="medicalTrainingForm">
          <div class="form-section mt-0">
            <h5 class="form-section__title">Medical School</h5>
            <hr />
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed
              neque nec dolor lacinia interdum quis nec nisi. Pellentesque dolor
              erat, egestas sit amet tortor at, condimentum tempor erat.
            </p>
            <div class="grid" *ngIf="!isEdit">
              <div class="col-12">
                <label
                  >Select the statement that best describes you (Country of
                  medical school)</label
                >
                <div>{{ medicalTraining.statement }}</div>
              </div>
              <div class="col-12">
                <label>Medical School</label>
                <div>{{ medicalTraining.medicalSchool.name }}</div>
              </div>
              <div class="col-12 md:col-4">
                <label>City or Town</label>
                <div>{{ medicalTraining.medicalSchool.city }}</div>
              </div>
              <div class="col-12 md:col-4">
                <label>State / Province / Territory</label>
                <div>{{ medicalTraining.medicalSchool.state }}</div>
              </div>
              <div class="col-12 md:col-4">
                <label>Country</label>
                <div>{{ medicalTraining.medicalSchool.country }}</div>
              </div>
              <div class="col-12 md:col-6">
                <label>Degree</label>
                <div>{{ medicalTraining.medicalSchool.degree }}</div>
              </div>
              <div class="col-12 md:col-6">
                <label>Year of Completion</label>
                <div>{{ medicalTraining.medicalSchool.yearGraduated }}</div>
              </div>
            </div>
            <div class="grid" *ngIf="isEdit">
              <div class="col-12">
                <label class="block" for="statement"
                  >Select the statement that best describes you (Country of
                  medical school)</label
                >
                <p-dropdown
                  inputId="statement"
                  [options]="fakeOptions"
                  name="statement"
                  [(ngModel)]="medicalTraining.statement"
                  optionLabel="itemDescription"
                  optionValue="itemValue"
                  appendTo="body"
                ></p-dropdown>
              </div>
              <div class="col-12">
                <label class="block" for="medicalSchool">Medical School</label>
                <input
                  id="medicalSchool"
                  pInputText
                  type="text"
                  placeholder="Enter school name"
                  name="medicalSchool"
                  [(ngModel)]="medicalTraining.medicalSchool.name"
                  required
                />
              </div>
              <div class="col-12 md:col-4">
                <label class="block" for="city">City or Town</label>
                <input
                  id="city"
                  pInputText
                  type="text"
                  placeholder="Enter city name"
                  name="city"
                  [(ngModel)]="medicalTraining.medicalSchool.city"
                  required
                />
              </div>
              <div class="col-12 md:col-4">
                <label class="block" for="state"
                  >State / Province / Territory</label
                >
                <p-dropdown
                  inputId="state"
                  [options]="fakeOptions"
                  placeholder="Choose state"
                  name="state"
                  [(ngModel)]="medicalTraining.medicalSchool.state"
                  optionLabel="itemDescription"
                  optionValue="itemValue"
                  appendTo="body"
                ></p-dropdown>
              </div>
              <div class="col-12 md:col-4">
                <label class="block" for="country">Country</label>
                <p-dropdown
                  inputId="country"
                  [options]="fakeOptions"
                  placeholder="Choose country"
                  name="country"
                  [(ngModel)]="medicalTraining.medicalSchool.country"
                  optionLabel="itemDescription"
                  optionValue="itemValue"
                  appendTo="body"
                ></p-dropdown>
              </div>
              <div class="col-12 md:col-6">
                <label class="block" for="degree">Degree</label>
                <input
                  id="degree"
                  pInputText
                  type="text"
                  placeholder="Enter degree name"
                  name="degree"
                  [(ngModel)]="medicalTraining.medicalSchool.degree"
                  required
                />
              </div>
              <div class="col-12 md:col-6">
                <label class="block" for="yearSchool">Year of Completion</label>
                <input
                  id="yearSchool"
                  pInputText
                  type="text"
                  placeholder="YYYY"
                  name="yearSchool"
                  [(ngModel)]="medicalTraining.medicalSchool.yearGraduated"
                  required
                />
              </div>
            </div>
          </div>

          <div class="form-section">
            <h5 class="form-section__title">Residency</h5>
            <hr />
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed
              neque nec dolor lacinia interdum quis nec nisi. Pellentesque dolor
              erat, egestas sit amet tortor at, condimentum tempor erat.
            </p>
            <div class="grid" *ngIf="!isEdit">
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label>Program Name</label>
                    <div>{{ medicalTraining.residency.programName }}</div>
                  </div>
                  <div class="col-12">
                    <label>Year of Completion</label>
                    <div>{{ medicalTraining.residency.yearOfCompletion }}</div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label>My program is not listed</label>
                    <div>{{ medicalTraining.residency.programNotListed }}</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="grid" *ngIf="isEdit">
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label class="block" for="residencyName"
                      >Enter program name</label
                    >
                    <input
                      id="residencyName"
                      pInputText
                      type="text"
                      placeholder="Enter program name"
                      name="residencyName"
                      [(ngModel)]="medicalTraining.residency.programName"
                      required
                    />
                  </div>
                  <div class="col-12">
                    <label class="block" for="residencyYear"
                      >Year of Completion</label
                    >
                    <input
                      id="residencyYear"
                      pInputText
                      type="text"
                      placeholder="YYYY"
                      name="residencyYear"
                      [(ngModel)]="medicalTraining.residency.yearOfCompletion"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label class="block" for="residencyNotListed"
                      >My program is not listed</label
                    >
                    <textarea
                      rows="5"
                      pInputTextarea
                      id="residencyNotListed"
                      placeholder="Explain..."
                      name="residencyNotListed"
                      [(ngModel)]="medicalTraining.residency.programNotListed"
                      required
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h5 class="form-section__title">Fellowship</h5>
            <hr />
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed
              neque nec dolor lacinia interdum quis nec nisi. Pellentesque dolor
              erat, egestas sit amet tortor at, condimentum tempor erat.
            </p>
            <div class="grid" *ngIf="!isEdit">
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label>Program Name</label>
                    <div>{{ medicalTraining.fellowship.programName }}</div>
                  </div>
                  <div class="col-12">
                    <label>Year of Completion</label>
                    <div>{{ medicalTraining.fellowship.yearOfCompletion }}</div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label>My program is not listed</label>
                    <div>{{ medicalTraining.fellowship.programNotListed }}</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="grid" *ngIf="isEdit">
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label class="block" for="fellowshipName"
                      >Enter program name</label
                    >
                    <input
                      id="fellowshipName"
                      pInputText
                      type="text"
                      placeholder="Enter program name"
                      name="fellowshipName"
                      [(ngModel)]="medicalTraining.fellowship.programName"
                      required
                    />
                  </div>
                  <div class="col-12">
                    <label class="block" for="fellowshipYear"
                      >Year of Completion</label
                    >
                    <input
                      id="fellowshipYear"
                      pInputText
                      type="text"
                      placeholder="YYYY"
                      name="fellowshipYear"
                      [(ngModel)]="medicalTraining.fellowship.yearOfCompletion"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="grid">
                  <div class="col-12">
                    <label class="block" for="fellowshipNotListed"
                      >My program is not listed</label
                    >
                    <textarea
                      rows="5"
                      pInputTextarea
                      id="fellowshipNotListed"
                      placeholder="Explain..."
                      name="fellowshipNotListed"
                      [(ngModel)]="medicalTraining.fellowship.programNotListed"
                      required
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h5 class="form-section__title">
              Certificates or Other Certifications
            </h5>
            <hr />
            <div class="grid" *ngIf="!isEdit">
              <div class="col-12">
                <label>FLS Certification</label>
                <!-- TODO: [Joe] handle viewing of uploaded document -->
                <div>{{ medicalTraining.certifications.flsCert.fileName }}</div>
              </div>
              <div class="col-12">
                <label>FES Certification</label>
                <!-- TODO: [Joe] handle viewing of uploaded document -->
                <div>{{ medicalTraining.certifications.fesCert.fileName }}</div>
              </div>
              <div class="col-12 sm:col-7 md:col-8">
                <label>Registered Physician in Vascular Interpretation</label>
                <div>
                  {{ medicalTraining.certifications.registeredPhysician }}
                </div>
              </div>
              <div class="col-12 sm:col-5 md:col-4">
                <label>Issue Date</label>
                <div>
                  {{
                    medicalTraining.certifications.issueDate
                      | date : 'shortDate'
                  }}
                </div>
              </div>
            </div>
            <div class="grid" *ngIf="isEdit">
              <div class="col-12 flex align-items-center">
                <div style="width: 100%">
                  <label class="block" for="flsCert">FLS Certification</label>
                  <div class="file-upload">
                    <label for="flsCert" class="file-upload__label">
                      <i class="fa-solid fa-file-lines"></i>
                      {{
                        medicalTraining.certifications.flsCert.newFileName ||
                          medicalTraining.certifications.flsCert.fileName ||
                          'empty'
                      }}
                    </label>
                    <input
                      type="file"
                      name="flsCert"
                      id="flsCert"
                      class="file-upload__input"
                      (change)="
                        onFileAdded(
                          $event,
                          medicalTraining.certifications.flsCert
                        )
                      "
                    />
                  </div>
                </div>
                <sl-button
                  variant="text"
                  class="btn-upload"
                  (click)="uploadFile(medicalTraining.certifications.flsCert)"
                  [disabled]="!medicalTraining.certifications.flsCert.newFile"
                  *ngIf="
                    medicalTraining.certifications.flsCert.newFile ||
                    !medicalTraining.certifications.flsCert.file
                  "
                >
                  <i class="fa-solid fa-cloud-arrow-up mr-1"></i>
                  Upload
                </sl-button>
                <sl-button
                  variant="text"
                  class="btn-remove"
                  (click)="removeFile(medicalTraining.certifications.flsCert)"
                  *ngIf="
                    !medicalTraining.certifications.flsCert.newFile &&
                    medicalTraining.certifications.flsCert.file
                  "
                >
                  <i class="fa-solid fa-x mr-1"></i>
                  Remove
                </sl-button>
              </div>
              <div class="col-12 flex align-items-center">
                <div style="width: 100%">
                  <label class="block" for="fesCert">FES Certification</label>
                  <div class="file-upload">
                    <label for="fesCert" class="file-upload__label">
                      <i class="fa-solid fa-file-lines"></i>
                      {{
                        medicalTraining.certifications.fesCert.newFileName ||
                          medicalTraining.certifications.fesCert.fileName ||
                          'empty'
                      }}
                    </label>
                    <input
                      type="file"
                      name="fesCert"
                      id="fesCert"
                      class="file-upload__input"
                      (change)="
                        onFileAdded(
                          $event,
                          medicalTraining.certifications.fesCert
                        )
                      "
                    />
                  </div>
                </div>
                <sl-button
                  variant="text"
                  class="btn-upload"
                  (click)="uploadFile(medicalTraining.certifications.fesCert)"
                  [disabled]="!medicalTraining.certifications.fesCert.newFile"
                  *ngIf="
                    medicalTraining.certifications.fesCert.newFile ||
                    !medicalTraining.certifications.fesCert.file
                  "
                >
                  <i class="fa-solid fa-cloud-arrow-up mr-1"></i>
                  Upload
                </sl-button>
                <sl-button
                  variant="text"
                  class="btn-remove"
                  (click)="removeFile(medicalTraining.certifications.fesCert)"
                  *ngIf="
                    !medicalTraining.certifications.fesCert.newFile &&
                    medicalTraining.certifications.fesCert.file
                  "
                >
                  <i class="fa-solid fa-x mr-1"></i>
                  Remove
                </sl-button>
              </div>

              <div class="col-12 sm:col-7 md:col-9">
                <label class="block" for="registeredPhysician"
                  >Registered Physician in Vascular Interpretation</label
                >
                <input
                  id="registeredPhysician"
                  pInputText
                  type="text"
                  name="registeredPhysician"
                  [(ngModel)]="
                    medicalTraining.certifications.registeredPhysician
                  "
                  required
                />
              </div>
              <div class="col-12 sm:col-5 md:col-3">
                <label class="block" for="issueDate">Issue Date</label>
                <p-calendar
                  id="issueDate"
                  [showIcon]="true"
                  name="issueDate"
                  [(ngModel)]="medicalTraining.certifications.issueDate"
                  appendTo="body"
                ></p-calendar>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h5 class="form-section__title">
              Additional / Advanced Medical Training
            </h5>
            <hr />
            <div class="grid">
              <div class="col-12">
                <sl-button
                  variant="default"
                  class="btn-add mt-4 mb-5"
                  (click)="showTrainingModal(null)"
                >
                  <i slot="prefix" class="fa-solid fa-plus"></i>
                  ADD RECORD
                </sl-button>
                <abs-grid
                  [columns]="trainingCols"
                  [data]="medicalTraining.additionalTraining"
                  (action)="handleGridAction($event)"
                  class="margin-bottom-2"
                ></abs-grid>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="flex justify-content-end" *ngIf="!isEdit">
              <sl-button
                variant="primary"
                style="width: 200px"
                (click)="toggleFormEdit(true)"
                >Edit</sl-button
              >
            </div>
            <div class="flex justify-content-end" *ngIf="isEdit">
              <sl-button variant="text" (click)="toggleFormEdit(false)"
                >Cancel</sl-button
              >
              <sl-button
                type="submit"
                style="width: 337px"
                variant="primary"
                (click)="save()"
                >Save</sl-button
              >
            </div>
          </div>
        </form>
      </sl-card>
    </div>
    <abs-modal
      [open]="showTrainingAddEdit"
      (closeDialog)="cancelAddEditTraining($event)"
      [title]="trainingAddEditTitle"
    >
      <abs-training-add-edit-modal
        [training]="tempTraining$"
        (cancelDialog)="cancelAddEditTraining($event)"
        (saveDialog)="saveTraining($event)"
      ></abs-training-add-edit-modal>
    </abs-modal>
  </section>
</ng-container>

<ng-template #loading>
  <div class="my-5 flex flex-column justify-content-center align-items-center">
    <sl-spinner
      class="block"
      style="font-size: 3rem; --indicator-color: var(--global-primary)"
    ></sl-spinner>
    <p>loading medical training...</p>
  </div>
</ng-template>
